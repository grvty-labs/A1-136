{% extends 'base.html' %}
{% block title %}{{ CONST_SYSTEM_NAME }} Poll{% endblock %}

{% block extra_cdn_css %}
  
  
{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{{ static("css/poll.css") }}">
  <style>
    .imagenFlechaNueva {
      background-image: url("{{ static("img/flechaNueva.svg") }}");
    }
  </style>
{% endblock %}

{% block top_cdn_js %}{% endblock %}
{% block top_js %}{% endblock %}

{% block content %}
  <div class="container-fluid">
    <div id="titlePoll" class="titlePoll">
      {{ CONST_SYSTEM_NAME }}
    </div>
    <div id="subtitlePoll" class="subtitle col-xs-6">
      Quisque vel nisl diam. Sed consectetur sed magna nec posuere.
      Lorem ipsum dolor sit amet, consectetur adipiscing elit.
    </div>
    
    
    <script type="text/javascript">
    window.onload = function() {
      $('#fullpage').fullpage();

      function getTotalQuestions(){
        questions = document.getElementsByClassName("questionRow");
        return questions.length;
      }

      function getCurrentQuestion(){
        questions = document.getElementsByClassName("questionRow");
        var current = 0;
        while(current < questions.length){
          if($(questions[current]).hasClass("active")){
            break;
          }
          current++;
        }
        return current+1;
      }

      function getCurrentProgress() {
        console.log(getCurrentQuestion());
        console.log(getTotalQuestions());
        scrollPercent = (getCurrentQuestion() / getTotalQuestions()) * 100;
        var position = scrollPercent;
        console.log(position);
        return position;
        // return getCurrentScroll()/getMaxScroll()*100;
      }

      function changeProgress() {
        var newProgress = getCurrentProgress();
        document.getElementById("progress-bar").style.width=getCurrentProgress()+"%";
        if(newProgress == 100){
          document.getElementById("poll-button").style.height="8%";
          document.getElementById("poll-button").style.zIndex="2";
        }
        else{
          document.getElementById("poll-button").style.height="0";
          document.getElementById("poll-button").style.zIndex="0";
        }
      }
      var observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutationRecord) {
              
             var q = changeProgress();
              console.log('scrolled');
          });    
      });

      var target = document.getElementById('fullpage');
      observer.observe(target, { attributes : true, attributeFilter : ['style'] });
    }
    </script>

    <div id="content" class="contentPoll"></div>

    <div>
      <form method="post" id="form-submit" action={{ url('poll-finish')}}>
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        <button type="submit" class="btn btn-primary btn-lg btn-block" id="poll-button">Guardar</button>
        
        <div class="progress-cont">
          <div class="progress" id="progress-bar"></div>
        </div>
      </form>
    </div>
  </div>
{% endblock %}


{% block bottom_cdn_js %}
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.7.9/jquery.fullPage.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.7.9/vendors/jquery.easings.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.7.9/vendors/jquery.slimscroll.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.7.9/vendors/jquery.slimscroll.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.7.9/vendors/jquery.slimscroll.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.7.9/jquery.fullPage.min.js"></script>

{% endblock %}

{% block bottom_js %}
  {{ render_bundle('poll') }}
{% endblock %}
